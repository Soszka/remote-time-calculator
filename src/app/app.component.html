<main class="app-wrapper">
  <section class="panel">
    <h1>‚è≥ Kalkulator ko≈Ñca pracy</h1>

    <form class="form" [formGroup]="form" novalidate>
      <div class="form-row">
        <label for="start-time">Start pracy</label>
        <input
          id="start-time"
          type="text"
          inputmode="numeric"
          placeholder="np. 8.43"
          formControlName="startTime"
        />
        <span class="error" *ngIf="form.controls.startTime.touched && form.controls.startTime.hasError('required')">
          Wpisz godzinƒô rozpoczƒôcia.
        </span>
        <span class="error" *ngIf="form.controls.startTime.touched && form.controls.startTime.hasError('invalidTime')">
          Niepoprawny format godziny.
        </span>
      </div>

      <div class="breaks-header">
        <span>Przerwy</span>
        <button type="button" class="ghost-button" (click)="addBreak()">+ Przerwa</button>
      </div>

      <div class="breaks" formArrayName="breaks">
        <div
          class="break-row"
          *ngFor="let breakGroup of breaks.controls; let i = index; trackBy: trackByIndex"
          [formGroupName]="i"
        >
          <div class="form-row inline">
            <label [for]="'break-start-' + i">Start</label>
            <input
              [id]="'break-start-' + i"
              type="text"
              inputmode="numeric"
              placeholder="np. 12.00"
              formControlName="start"
            />
            <span class="error" *ngIf="breakGroup.controls.start.touched && breakGroup.controls.start.hasError('invalidTime')">
              Niepoprawna godzina.
            </span>
          </div>

          <div class="form-row inline">
            <label [for]="'break-end-' + i">Koniec</label>
            <input
              [id]="'break-end-' + i"
              type="text"
              inputmode="numeric"
              placeholder="np. 12.30"
              formControlName="end"
            />
            <span class="error" *ngIf="breakGroup.controls.end.touched && breakGroup.controls.end.hasError('invalidTime')">
              Niepoprawna godzina.
            </span>
          </div>

          <button type="button" class="remove-button" (click)="removeBreak(i)" aria-label="Usu≈Ñ przerwƒô">
            ‚úñ
          </button>

          <div class="error break-warning" *ngIf="hasIncompleteBreak(breakGroup)">
            Uzupe≈Çnij obie godziny.
          </div>
        </div>
      </div>

      <button type="button" class="primary-button" (click)="calculate()" [disabled]="!canCalculate">
        Przelicz
      </button>
    </form>

    <section *ngIf="result() as payload" class="result-block">
      <div @fadeSlide class="card highlight-card">
        <div class="end-time">üö™ {{ payload.endTime }}</div>
        <div class="remaining">‚è≥ {{ payload.remainingLabel }}</div>
      </div>
      <div @fadeSlide class="card message-card">
        <p>{{ payload.message }}</p>
      </div>
    </section>
  </section>
</main>
