<main class="app-wrapper">
  <section class="panel">
    <h1>‚è≥ Kalkulator ko≈Ñca pracy</h1>

    <form class="form" [formGroup]="form" novalidate>
      <div class="form-row">
        <label for="start-time">Start pracy</label>
        <input
          id="start-time"
          type="text"
          inputmode="numeric"
          placeholder="np. 8.43"
          formControlName="startTime"
        />
        <span class="error" *ngIf="form.controls.startTime.touched && form.controls.startTime.hasError('required')">
          Wpisz godzinƒô rozpoczƒôcia.
        </span>
        <span class="error" *ngIf="form.controls.startTime.touched && form.controls.startTime.hasError('invalidTime')">
          Niepoprawny format godziny.
        </span>
        <span class="error" *ngIf="form.controls.startTime.touched && form.controls.startTime.hasError('tooEarly')">
          Start pracy nie mo≈ºe byƒá wcze≈õniejszy ni≈º 05:30.
        </span>
      </div>

      <div class="breaks-controls">
        <button type="button" class="ghost-button" (click)="addBreak()">+ Przerwa</button>
      </div>

      <div class="breaks-wrapper" formArrayName="breaks">
        <div class="breaks-title" *ngIf="breaks.length > 0">Przerwy</div>

        <div class="breaks" *ngIf="breaks.length > 0">
          <div
            class="break-row"
            *ngFor="let breakGroup of breaks.controls; let i = index; trackBy: trackByIndex"
            [formGroupName]="i"
          >
            <div class="form-row inline">
              <label [for]="'break-start-' + i">Start</label>
              <input
                [id]="'break-start-' + i"
                type="text"
                inputmode="numeric"
                placeholder="np. 12.00"
                formControlName="start"
              />
              <span class="error" *ngIf="breakGroup.controls.start.touched && breakGroup.controls.start.hasError('invalidTime')">
                Niepoprawna godzina.
              </span>
            </div>

            <div class="form-row inline">
              <label [for]="'break-end-' + i">Koniec</label>
              <input
                [id]="'break-end-' + i"
                type="text"
                inputmode="numeric"
                placeholder="np. 12.30"
                formControlName="end"
              />
              <span class="error" *ngIf="breakGroup.controls.end.touched && breakGroup.controls.end.hasError('invalidTime')">
                Niepoprawna godzina.
              </span>
            </div>

            <button type="button" class="remove-button" (click)="removeBreak(i)" aria-label="Usu≈Ñ przerwƒô">
              ‚úñ
            </button>

            <div class="error break-warning" *ngIf="hasIncompleteBreak(breakGroup)">
              Uzupe≈Çnij obie godziny.
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="primary-button" (click)="calculate()" [disabled]="!canCalculate">
        Przelicz
      </button>

      <div class="schedule-error" *ngIf="scheduleError() as error">{{ error }}</div>
    </form>

    <section *ngIf="result() as payload" class="result-block">
      <div class="card highlight-card fade-in" [class.complete]="payload.state === 'complete'">
        <div class="celebration" *ngIf="payload.state === 'complete'" aria-hidden="true">
          <div class="confetti">
            <span *ngFor="let piece of confettiPieces; trackBy: trackByIndex"></span>
          </div>
          <div class="fireworks">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <div class="summary-line">
          <div class="metric metric-primary">
            <span class="metric-icon">üö™</span>
            <span class="metric-text">
              <span class="metric-label">Wyj≈õcie o</span>
              <span class="metric-value">{{ payload.endTime }}</span>
            </span>
          </div>
          <div class="metric metric-secondary">
            <span class="metric-icon">‚è≥</span>
            <span class="metric-text">
              <span class="metric-label">Czas do ko≈Ñca</span>
              <span class="metric-value">{{ payload.remainingLabel }}</span>
            </span>
          </div>
        </div>
      </div>
      <div class="card message-card fade-in">
        <p>{{ payload.message }}</p>
      </div>
    </section>
  </section>
</main>
